<!DOCTYPE html>
<html>

<head>
  <!--Import Google Icon Font-->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <!--Import materialize.css-->
  <link type="text/css" rel="stylesheet" href="/static/css/materialize.min.css" media="screen,projection" />
  <link type="text/css" rel="stylesheet" href="/static/css/xda.css" media="screen,projection" />
  <link type="text/css" rel="stylesheet" href="/static/css/header.css" media="screen,projection" />
  <link type="text/css" rel="stylesheet" href="/static/css/index.css" media="screen,projection" />

  <link rel="stylesheet" href="/static/font-awesome/css/font-awesome.min.css">
  <!--Let browser know website is optimized for mobile-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="image_src" href="{{ banner_square_url }}">
  <meta name="thumbnail" content="{{ icon_url }}">
  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "ImageObject",
      "contentUrl": "{{ banner_square_url }}"
    }
  </script>
  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Organization",
      "name": "XDA Labs | {{ title }}",
      "image": "{{ banner_square_url }}",
      "url": "https://labs.xda-developers.com/store/app/{{ package_name }}",
      "logo": "{{ icon_url }}"
    }
  </script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-12268453-11', 'auto');
    ga('send', 'pageview');

  </script>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>XDA Labs | Index</title>
  <meta property="og:title" content="XDA Labs | {{ title }}" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://labs.xda-developers.com/store/app/{{ package_name }}" />
  <meta property="og:image" content="{{ banner_square_url }}" />
  <!-- Might be nice to have a short blurb description in each app's data for this bit of metadata
    <meta property="og:description" content="A redesign of the XDA Labs app page. Fully responsive Material Design." />
  -->
  <link rel="shortcut icon" href="{{ icon_url }}" type="image/x-icon">
  <meta name="theme-color" content="#424242">


</head>

<body>

  {% include "header.html" %}

      <div class="row grey darken-3" style="margin-bottom: 0px">
        <div class="container">
        <div class="col s12">
          <div class="row" style="margin-top: 20px;">
            <div class="col s12 m8 l8">
              <h5 class="white-text">Support independent Android development</h5>
              <p class="white-text">XDA Labs is a platform that allows developers to freely distribute and promote their apps -- without fear of having their products removed due to content restrictions or corporate censorship.  Labs is free to use and developers keep 100% from Paypal and Bitcoin purchases.</p>
            </div>
            <div class="col s12 m4 l4 center">
              <a class="waves-effect waves-light btn white black-text" href="https://labs.xda-developers.com/latest" style="margin-top: 20px; margin-bottom: 10px">Download Labs</a>
              {% with publish_string="Publish my app" manage_string="Manage my apps" %}
              <a href="{{ xda_authorize_url }}">
                <h5 style="margin-top: 10px; font-size: 20px" class="orange-text">{% if has_apps %}{{ manage_string }}{% else %}{{ publish_string }}{% endif %}</h5>
              </a>
              {% endwith %}
            </div>
          </div>
        </div>
      </div></div>
      <div class="row grey darken-2">
      <div class="container">

        <div class="col s12">
          <div class="row valign-wrapper" style="margin-top: 10px;">
            <div class="col s6 m6 l6 center sort-container">
                <div style="display: inline-flex; margin-top: 10px; margin-right: 10px;" class="center">
                    <a class='dropdown-button btn white black-text' href='#' data-hover="true" data-beloworigin="true" data-activates='sort_dropdown'>{{ filters.sort_selected }}</a>
                    <ul id='sort_dropdown' class='dropdown-content category-list-item'>
                      <li {% if filters.sort_index == 0 %}class="selected"{% endif %}><a data-slug-name="popularity" class="sort-item grey-text text-darken-2">Popularity</a></li>
                      <li {% if filters.sort_index == 1 %}class="selected"{% endif %}><a data-slug-name="recent" class="sort-item grey-text text-darken-2">Recent</a></li>
                      <li {% if filters.sort_index == 2 %}class="selected"{% endif %}><a data-slug-name="rating" class="sort-item grey-text text-darken-2">Ratings</a></li>
                    </ul>
                </div>
                <div style="display: inline-flex; margin-top: 10px; margin-right: 10px" class="center">
                    <a style="white-space: nowrap" class='dropdown-button btn white black-text' href='#' data-hover="true" data-beloworigin="true" data-activates='category_dropdown'>{% if filters.category_index >= 0 %}{{ filters.category_selected }}{% else %}Categories{% endif %}</a>
                    <ul id='category_dropdown' class='dropdown-content category-list-item'>
                      {% for category in categories %}
                        <li {% if forloop.counter0 == filters.category_index %}class="selected"{% endif %}><a data-index="{{ forloop.counter0 }}" class="category-item grey-text text-darken-2" href="#!">{{ category }}</a></li>
                      {% endfor %}
                    </ul>
                </div>
            </div>
            <div class="col s6 m6 l6 center filter-container">
                  <div data-slug-name="watchlist" class="filter-item {% if filters.watchlist %}activeTag {% endif %}chip">Watchlist</div>
                  <div data-slug-name="paid" class="filter-item {% if filters.paid %}activeTag {% endif %}chip">Paid</div>
                  <div data-slug-name="downloaded" class="filter-item {% if filters.downloaded %}activeTag {% endif %}chip">Downloaded</div>
              </div>

          </div>
        </div>
      </div>
    </div>
      <div class="container">
        <div class="row">
          {% for app in apps %}
          <div class="col s12 m6 l4 app-parent" data-package-name="{{ app.package_name }}">

            <div class="card horizontal" style="height: 140px;">
              <div class="app-item card-image">
                <img style="height: 140px; object-fit: cover;" src="{{ app.banner_square_url }}">
              </div>
              <div class="card-stacked">
                <div class="card-content" style="padding: 12px">
                  <div style="height: 54px; line-height: 18px; overflow: hidden; margin-bottom: 8px;">
                      <img class="app-item" style="margin-left: 10px; height: 30px; width: 30px; top: 4px; float: right" src="{{ app.icon_url }}" />
                      <span class="app-item" style="font-size: 16px; display: block;">{{ app.title }}</span>
                  </div>
                  <div style="font-size: 12px; line-height: 17px; height: 17px; margin-top: 8px; margin-bottom: 8px; overflow: hidden;">
                      <div style="float: right; width: 34px">
                          <span class="orange-text">&#x2605;</span> {{ app.avg_rating }}
                      </div>
                      <span style="display: block; margin-right: 38px; word-break: break-all;">{{ app.dev.display_name }}</span>
                  </div>
                  <div class="category-link-container">
                  {% for category in app.categories %}
                    <span data-index="{{ category.id }}" class="category-item">{{ category.name }}</span>{% if not forloop.last %}, {% endif %}
                  {% endfor %}
                  </div>
                </div>

              </div>
            </div>
          </div>
          {% endfor %}

        </div>
      </div>

    <!--Import jQuery before materialize.js-->
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script type="text/javascript" src="/static/js/materialize.min.js"></script>
    <script>
      // /store/<sort_slugname>/category_id/filter1/filter2/filter3

      // 1) Popularity clicked
      // 2) Category clicked
      // 3) Filter clicked
      // 4) Author clicked

      let StoreUrl = {
          sort_slug: "{{ filters.sort_slugname }}",
          category_id: {{ filters.category_index }},
          filters: {
              "paid": {{ filters.paid|lower }},
              "watchlist": {{ filters.watchlist|lower }},
              "downloaded": {{ filters.downloaded|lower }}
          },
          baseUrl: "/store/",
          url: this.baseUrl,

          getSort: function() {
              this.url += this.sort_slug + "/"
              return this
          },

          addCategory: function() {
              if (this.category_id >= 0) {
                  this.url += this.category_id + "/"
              }
              return this
          },

          addFilters: function() {
              for (let f in this.filters) {
                  if (this.filters[f]) {
                      this.url += f + "/"
                  }
              }
              return this
          },

          getUrl: function() {
              return this.url
          },

          newUrl: function() {
              this.url = this.baseUrl
              return this
          },

          setSort: function(s) {
              this.sort_slug = s
              return this
          },
          setCategory: function(i) {
              this.category_id = i
              return this
          },
          setFilter: function(s, b) {
              this.filters[s] = b
              return this
          }

      }

      const url = StoreUrl

      function openApp(s) {
        window.location.href = "https://labs.xda-developers.com/store/app/" + s
      }

      loadIndexUrl = function() {
          alert(url.getSort().addCategory().addFilters().getUrl())
      }

      function openSort(s) {
          url.newUrl().setSort(s)
          loadIndexUrl()
      }

      function openCategory(i) {
          url.newUrl().setCategory(i)
          loadIndexUrl()
      }

      function openFilter(s, b) {
          url.newUrl().setFilter(s, b)
          loadIndexUrl()
      }

      $(".filter-item").on("click", function() {
          $(this).toggleClass("activeTag")

          let isFiltered = $(this).hasClass("activeTag")
          openFilter($(this).data("slugName"), isFiltered)
      })

      $(".category-item").on("click", function(e) {
          openCategory($(this).data("index"))
      })

      $(".sort-item").on("click", function() {
          openSort($(this).data("slugName"))
      })

      $(".app-item").on("click", function() {
          packageName = $(this).closest(".app-parent").data("packageName")
          openApp(packageName)
      })

    </script>
  <footer class="page-footer transparent">
    <div class="footer-copyright grey darken-3">
      <div class="container">
        XDA Labs, an XDA service
      </div>
    </div>
  </footer>

</body>

</html>
